# üìß Telegram Mail Aggregator

Telegram-–±–æ—Ç –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –ø–∏—Å–µ–º –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π serverless-–¥–µ–ø–ª–æ—è.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì¨ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –Ω–æ–≤—ã—Ö –ø–∏—Å—å–º–∞—Ö
- üìã **–ü–∞–≥–∏–Ω–∞—Ü–∏—è** ‚Äî —É–¥–æ–±–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–∏—Å–µ–º
- üìé **–í–ª–æ–∂–µ–Ω–∏—è** ‚Äî –ø–µ—Ä–µ—Å—ã–ª–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 50 –ú–ë
- üîê **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî –∑–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–º —á–µ—Ä–µ–∑ Supabase
- üöÄ **Serverless** ‚Äî –¥–µ–ø–ª–æ–π –Ω–∞ Vercel —Å webhook
- ‚è∞ **Cron** ‚Äî –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—á—Ç—ã

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.13+
- –ê–∫–∫–∞—É–Ω—Ç Yandex —Å –ø–∞—Ä–æ–ª–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- Telegram Bot Token
- Supabase –ø—Ä–æ–µ–∫—Ç (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/your-username/TelegramMailAgregator.git
cd TelegramMailAgregator

# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
# –∏–ª–∏ —Å uv
uv sync
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=123456789

# –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç–∞
YANDEX_EMAIL=your@yandex.ru
YANDEX_APP_PASSWORD=your_app_password

# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=your_anon_key

# –ë–æ—Ç
BOT_PASSWORD=secret123
CRON_SECRET=your_cron_secret

# –°–µ—Ä–≤–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
HOST=0.0.0.0
PORT=5000
POLL_INTERVAL=30
```

### 2. –ù–∞—Å—Ç—Ä–æ–π –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç—É

1. –í–∫–ª—é—á–∏ IMAP: **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü–æ—á—Ç–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã**
2. –°–æ–∑–¥–∞–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: https://id.yandex.ru/security/app-passwords
3. –£–∫–∞–∂–∏ email –∏ –ø–∞—Ä–æ–ª—å –≤ `.env`

### 3. –°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É –≤ Supabase

```sql
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY,
    name TEXT NOT NULL,
    firstname TEXT,
    username TEXT,
    is_registered BOOLEAN DEFAULT FALSE,
    phone TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ (polling)

```bash
python main.py
```

–ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:5000` –∏ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—á—Ç—É –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.

### Vercel (serverless)

1. –ü–æ–¥–∫–ª—é—á–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Vercel
2. –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞
3. –£—Å—Ç–∞–Ω–æ–≤–∏ webhook:
   ```
   https://api.telegram.org/bot<TOKEN>/setWebhook?url=https://your-app.vercel.app/
   ```

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/check` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∏—Å—å–º–∞ |
| `/mail` | –û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∏—Å–µ–º |
| `/queue` | –ü–∏—Å–µ–º –≤ –æ—á–µ—Ä–µ–¥–∏ |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, FastAPI + polling
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ index.py         # Vercel serverless handler
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ components/      # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–Ω–æ–ø–æ–∫ (Factory pattern)
‚îÇ   ‚îú‚îÄ‚îÄ handlers/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/       # Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Mail, Telegram, User)
‚îÇ   ‚îî‚îÄ‚îÄ templates/       # –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ models.py        # SQLModel –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ supabase.py      # Supabase –∫–ª–∏–µ–Ω—Ç
```

## üîß API Endpoints

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `POST` | `/webhook` | Telegram webhook |
| `POST` | `/cron` | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç Bearer token) |
| `GET` | `/health` | Health check |
| `GET` | `/` | –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ |

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **FastAPI** + **Uvicorn** ‚Äî –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- **httpx** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã
- **aiogram** ‚Äî —Ç–∏–ø—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä Telegram
- **html2text** ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML –≤ —Ç–µ–∫—Å—Ç
- **supabase** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **python-dotenv** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
